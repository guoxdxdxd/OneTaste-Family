basePath: /api/v1
definitions:
  models.CaptchaResponse:
    description: 图形验证码返回数据
    properties:
      captcha_key:
        description: 验证码编码
        example: 01J0XYZABCD1234EFG567HIJK
        type: string
      expire_in:
        description: 过期时间（秒）
        example: 30
        type: integer
      image_base64:
        description: 图形验证码Base64
        example: data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...
        type: string
    type: object
  models.CookingStep:
    properties:
      content:
        type: string
      image_url:
        type: string
      order:
        type: integer
      step_id:
        type: string
    type: object
  models.CookingStepInput:
    properties:
      content:
        maxLength: 2000
        type: string
      image_url:
        maxLength: 500
        type: string
      order:
        maximum: 200
        minimum: 1
        type: integer
    required:
    - content
    - order
    type: object
  models.CreateDishRequest:
    properties:
      category:
        maxLength: 50
        type: string
      description:
        maxLength: 2000
        type: string
      image_url:
        maxLength: 500
        type: string
      ingredients:
        items:
          $ref: '#/definitions/models.IngredientInput'
        type: array
      name:
        maxLength: 100
        type: string
      steps:
        items:
          $ref: '#/definitions/models.CookingStepInput'
        type: array
    required:
    - ingredients
    - name
    - steps
    type: object
  models.CreateFamilyRequest:
    properties:
      description:
        description: 家庭描述，可选
        example: 温馨的家庭
        maxLength: 500
        type: string
      name:
        description: 家庭名称
        example: 张家的厨房
        maxLength: 100
        type: string
    required:
    - name
    type: object
  models.DishCreateResponse:
    properties:
      dish_id:
        type: string
      name:
        type: string
    type: object
  models.DishDetailResponse:
    properties:
      category:
        type: string
      created_at:
        type: string
      description:
        type: string
      dish_id:
        type: string
      image_url:
        type: string
      ingredients:
        items:
          $ref: '#/definitions/models.Ingredient'
        type: array
      name:
        type: string
      steps:
        items:
          $ref: '#/definitions/models.CookingStep'
        type: array
      updated_at:
        type: string
    type: object
  models.DishListResponse:
    properties:
      dishes:
        items:
          $ref: '#/definitions/models.DishSummary'
        type: array
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
    type: object
  models.DishSummary:
    properties:
      category:
        type: string
      created_at:
        type: string
      dish_id:
        type: string
      image_url:
        type: string
      name:
        type: string
      updated_at:
        type: string
    type: object
  models.FamilyInfoResponse:
    properties:
      description:
        example: 温馨的家庭
        type: string
      dish_count:
        example: 15
        type: integer
      family_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
      max_dishes:
        example: 30
        type: integer
      member_count:
        example: 3
        type: integer
      name:
        example: 张家的厨房
        type: string
      owner_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6Q
        type: string
    type: object
  models.FamilyInviteRequest:
    properties:
      action:
        example: accept
        type: string
      family_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
      family_name:
        example: 张家的厨房
        type: string
      inviter_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6Q
        type: string
      inviter_nickname:
        example: 张三
        type: string
    required:
    - action
    - family_id
    - family_name
    - inviter_id
    - inviter_nickname
    type: object
  models.FamilyJoinResponse:
    properties:
      family_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
      joined_at:
        example: "2024-01-01T00:00:00Z"
        type: string
      member_role:
        example: member
        type: string
    type: object
  models.FamilyMemberInfo:
    properties:
      avatar:
        example: https://.../avatar.jpg
        type: string
      joined_at:
        example: "2024-01-01T00:00:00Z"
        type: string
      nickname:
        example: 李四
        type: string
      role:
        example: member
        type: string
      user_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6R
        type: string
    type: object
  models.FamilyResponse:
    properties:
      description:
        example: 温馨的家庭
        type: string
      family_id:
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
      max_dishes:
        example: 30
        type: integer
      member_count:
        example: 1
        type: integer
      name:
        example: 张家的厨房
        type: string
    type: object
  models.Ingredient:
    properties:
      amount:
        type: number
      category:
        type: string
      ingredient_id:
        type: string
      name:
        type: string
      sort_order:
        type: integer
      storage_days:
        type: integer
      unit:
        type: string
    type: object
  models.IngredientInput:
    properties:
      amount:
        type: number
      category:
        maxLength: 50
        type: string
      name:
        maxLength: 100
        type: string
      sort_order:
        maximum: 1000
        minimum: 0
        type: integer
      storage_days:
        maximum: 365
        minimum: 0
        type: integer
      unit:
        maxLength: 20
        type: string
    required:
    - amount
    - name
    - unit
    type: object
  models.LoginRequest:
    description: 用户登录请求参数
    properties:
      password:
        description: 密码
        example: password123
        type: string
      phone:
        description: 手机号
        example: "13800138000"
        type: string
    required:
    - password
    - phone
    type: object
  models.LoginResponse:
    description: 用户登录成功返回的数据
    properties:
      expires_in:
        description: Token过期时间（秒）
        example: 86400
        type: integer
      token:
        description: JWT Token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
      user_id:
        description: 用户ID
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
    type: object
  models.MediaUploadResponse:
    properties:
      bucket:
        type: string
      content_type:
        type: string
      directory:
        type: string
      filename:
        type: string
      object_key:
        type: string
      size:
        type: integer
      url:
        type: string
    type: object
  models.MembershipInfo:
    description: 用户会员信息
    properties:
      expires_at:
        description: 到期时间，免费版为null
        example: "2024-12-31T23:59:59Z"
        type: string
      type:
        description: 会员类型：free-免费版，premium-付费版
        example: free
        type: string
    type: object
  models.RegisterRequest:
    description: 用户注册请求参数
    properties:
      captcha_key:
        description: 验证码编码
        example: 01J0XYZABCD1234EFG567HIJK
        type: string
      nickname:
        description: 昵称
        example: 张三
        type: string
      password:
        description: 密码，至少6位
        example: password123
        minLength: 6
        type: string
      phone:
        description: 手机号，11位数字
        example: "13800138000"
        type: string
      verify_code:
        description: 图形验证码内容，不区分大小写
        example: A9d3
        type: string
    required:
    - captcha_key
    - nickname
    - password
    - phone
    - verify_code
    type: object
  models.RegisterResponse:
    description: 用户注册成功返回的数据
    properties:
      token:
        description: JWT Token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
      user_id:
        description: 用户ID
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
    type: object
  models.UpdateDishRequest:
    properties:
      category:
        maxLength: 50
        type: string
      description:
        maxLength: 2000
        type: string
      image_url:
        maxLength: 500
        type: string
      ingredients:
        items:
          $ref: '#/definitions/models.IngredientInput'
        type: array
      name:
        maxLength: 100
        type: string
      steps:
        items:
          $ref: '#/definitions/models.CookingStepInput'
        type: array
    required:
    - ingredients
    - name
    - steps
    type: object
  models.UserInfoResponse:
    description: 用户信息返回数据
    properties:
      avatar:
        description: 头像URL
        example: https://...
        type: string
      membership:
        allOf:
        - $ref: '#/definitions/models.MembershipInfo'
        description: 会员信息
      nickname:
        description: 昵称
        example: 张三
        type: string
      phone:
        description: 手机号
        example: "13800138000"
        type: string
      user_id:
        description: 用户ID
        example: 01HZX1YF8Y6S7K4V9Q2J3M5N6P
        type: string
    type: object
  utils.FieldError:
    description: 字段验证错误信息
    properties:
      field:
        description: 错误字段名
        example: phone
        type: string
      message:
        description: 错误消息
        example: 手机号格式不正确
        type: string
    type: object
  utils.Response:
    description: 统一的API响应格式
    properties:
      code:
        description: 响应状态码
        example: 200
        type: integer
      data:
        description: 响应数据
      errors:
        description: 字段错误列表（仅在错误时返回）
        items:
          $ref: '#/definitions/utils.FieldError'
        type: array
      message:
        description: 响应消息
        example: success
        type: string
    type: object
host: localhost:8080
info:
  contact:
    email: support@onetastefamily.com
    name: API Support
    url: http://www.onetastefamily.com/support
  description: 家庭饮食管理系统的后端API接口文档
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  termsOfService: http://swagger.io/terms/
  title: OneTaste Family API
  version: "1.0"
paths:
  /auth/captcha:
    get:
      description: 获取一个带干扰的图形验证码图片及对应的编码
      parameters:
      - description: 图片宽度（120-360），默认220
        in: query
        name: width
        type: integer
      - description: 图片高度（40-160），默认70
        in: query
        name: height
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 验证码获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.CaptchaResponse'
              type: object
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      summary: 获取图形验证码
      tags:
      - 用户认证
  /auth/login:
    post:
      consumes:
      - application/json
      description: 用户登录接口，支持手机号和密码登录。登录成功后返回用户ID、JWT Token和过期时间。
      parameters:
      - description: 登录请求参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.LoginResponse'
              type: object
        "400":
          description: 手机号或密码错误
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      summary: 用户登录
      tags:
      - 用户认证
  /auth/register:
    post:
      consumes:
      - application/json
      description: 用户注册接口，支持手机号、密码、验证码、昵称注册。注册成功后返回用户ID和JWT Token。
      parameters:
      - description: 注册请求参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 注册成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.RegisterResponse'
              type: object
        "400":
          description: 请求参数错误、验证码错误或手机号已注册
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      summary: 用户注册
      tags:
      - 用户认证
  /dishes:
    get:
      consumes:
      - application/json
      description: 按照家庭返回菜式列表，支持按分类和名称关键字筛选。需要Bearer Token认证。
      parameters:
      - description: 页码（默认1）
        in: query
        name: page
        type: integer
      - description: 每页数量（默认20，最大100）
        in: query
        name: page_size
        type: integer
      - description: 菜式分类
        in: query
        name: category
        type: string
      - description: 名称关键字
        in: query
        name: keyword
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.DishListResponse'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 尚未加入家庭
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 获取菜式列表
      tags:
      - 菜式
    post:
      consumes:
      - application/json
      description: 向当前家庭食谱库添加菜式，至少包含一个食材和一个烹饪步骤。需要Bearer Token认证。
      parameters:
      - description: 创建菜式请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.CreateDishRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.DishCreateResponse'
              type: object
        "400":
          description: 参数错误或业务限制
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 尚未加入家庭
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 创建菜式
      tags:
      - 菜式
  /dishes/{id}:
    delete:
      consumes:
      - application/json
      description: 仅允许菜式创建者或家庭管理员删除菜式。需要Bearer Token认证。
      parameters:
      - description: 菜式ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/utils.Response'
        "403":
          description: 无权限
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 菜式或家庭不存在
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 删除菜式
      tags:
      - 菜式
    get:
      consumes:
      - application/json
      description: 返回菜式的食材和烹饪步骤信息。需要Bearer Token认证。
      parameters:
      - description: 菜式ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.DishDetailResponse'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 菜式或家庭不存在
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 获取菜式详情
      tags:
      - 菜式
    put:
      consumes:
      - application/json
      description: 仅允许菜式创建者或家庭管理员编辑菜式。需要Bearer Token认证。
      parameters:
      - description: 菜式ID
        in: path
        name: id
        required: true
        type: string
      - description: 更新菜式请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.UpdateDishRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.DishDetailResponse'
              type: object
        "400":
          description: 参数错误或业务限制
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/utils.Response'
        "403":
          description: 无权限
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 菜式或家庭不存在
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 更新菜式
      tags:
      - 菜式
  /family/create:
    post:
      consumes:
      - application/json
      description: 创建一个新的家庭，创建者自动成为owner并加入家庭。需要Bearer Token认证。
      parameters:
      - description: 创建家庭请求参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.CreateFamilyRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.FamilyResponse'
              type: object
        "400":
          description: 请求参数错误或已加入家庭
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: 未授权或Token无效
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 创建家庭
      tags:
      - 家庭
  /family/info:
    get:
      consumes:
      - application/json
      description: 获取当前用户所属家庭信息，包括成员数量与菜式数量。需要Bearer Token认证。
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.FamilyInfoResponse'
              type: object
        "401":
          description: 未授权或Token无效
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 尚未创建或加入家庭
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 获取家庭信息
      tags:
      - 家庭
  /family/member/invite:
    post:
      consumes:
      - application/json
      description: 用户在前端点击“同意”后调用该接口，加入邀请人所在家庭。需要Bearer Token认证。
      parameters:
      - description: 扫码加入家庭请求参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.FamilyInviteRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 加入成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.FamilyJoinResponse'
              type: object
        "400":
          description: 参数错误或业务限制
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: 未授权或Token无效
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 家庭不存在或邀请无效
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 扫码加入家庭
      tags:
      - 家庭
  /family/members:
    get:
      consumes:
      - application/json
      description: 返回当前用户所属家庭的成员列表。需要Bearer Token认证。
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.FamilyMemberInfo'
                  type: array
              type: object
        "401":
          description: 未授权或Token无效
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 尚未创建或加入家庭
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 获取家庭成员列表
      tags:
      - 家庭
  /health:
    get:
      consumes:
      - application/json
      description: 检查服务是否正常运行
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 健康检查
      tags:
      - 系统
  /media/upload:
    post:
      consumes:
      - multipart/form-data
      description: 上传图片等媒体文件，并返回可访问地址。需要 Bearer Token。
      parameters:
      - description: 待上传文件
        in: formData
        name: file
        required: true
        type: file
      - description: 文件目录前缀，例如 /user/head/{userId}、/family/{familyId}/dishes/{dishId}
        in: formData
        name: path
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.MediaUploadResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/utils.Response'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 上传媒体文件
      tags:
      - 媒体
  /user/info:
    get:
      consumes:
      - application/json
      description: 获取当前登录用户的基本信息和会员状态。需要Bearer Token认证。
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/utils.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.UserInfoResponse'
              type: object
        "401":
          description: 未授权或Token无效
          schema:
            $ref: '#/definitions/utils.Response'
        "404":
          description: 用户不存在
          schema:
            $ref: '#/definitions/utils.Response'
        "500":
          description: 服务器内部错误
          schema:
            $ref: '#/definitions/utils.Response'
      security:
      - BearerAuth: []
      summary: 获取用户信息
      tags:
      - 用户
securityDefinitions:
  BearerAuth:
    description: 使用 "Bearer {token}" 格式，token 通过登录接口获取
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
