# 需求详细文档

## 1. 用户需求分析

### 1.1 目标用户
- **主要用户**：家庭主妇/主夫，负责家庭饮食和采购
- **次要用户**：家庭成员，参与菜单选择
- **用户特征**：
  - 年龄：25-50岁
  - 有选择困难症
  - 关注健康饮食
  - 希望提高做饭效率

### 1.2 核心痛点
1. **不知道吃什么**：每天为吃什么而烦恼
2. **不知道应该吃什么**：不了解什么食物适合自己
3. **不知道买什么**：采购时不知道需要什么食材
4. **不知道买多少**：不清楚食材的采购量
5. **食材存放问题**：不知道食材可以存放多久

## 2. 功能需求详细说明

### 2.1 家庭管理模块

#### 2.1.1 创建家庭
- **功能描述**：用户可以创建一个家庭
- **输入**：家庭名称、家庭描述（可选）
- **输出**：家庭ID、家庭信息
- **业务规则**：
  - 一个用户只能创建一个家庭或加入一个家庭
  - 创建者自动成为家庭管理员（owner）
  - 家庭创建后，创建者自动加入该家庭

#### 2.1.2 邀请家庭成员
- **功能描述**：家庭管理员在手机端生成邀请二维码，邀请其他用户加入家庭
- **输入**：邀请URL中的参数（邀请人ID、邀请人昵称、家庭ID、家庭名称）、被邀请人的登录态、用户点击的同意/拒绝动作
- **输出**：加入家庭结果或错误提示
- **邀请方式**：
  - 邀请人点击“邀请”按钮后，前端使用邀请人ID、昵称、当前家庭ID、家庭名称拼接H5/小程序邀请URL，并生成二维码
  - 被邀请人扫码进入邀请页面，若未登录则先跳转登录，登录后回到邀请页展示“XXX邀请你加入他的XX家庭”的提示
- **页面交互**：邀请页展示受邀信息及“同意/拒绝”两个按钮，拒绝时直接关闭页面；同意时调用加入家庭接口完成绑定
- **业务规则**：
  - 一个家庭最多10个成员（可配置）
  - 被邀请人需要注册账号且接收方只能加入一个家庭
  - 被邀请人默认角色为member
  - 邀请页所有文案均来源于二维码URL参数，前端需做好安全校验

#### 2.1.3 家庭成员管理
- **功能描述**：查看、编辑、删除家庭成员
- **功能点**：
  - 查看成员列表
  - 修改成员角色（owner可操作）
  - 移除成员（owner可操作）
  - 成员退出家庭

### 2.2 食谱管理模块

#### 2.2.1 添加菜式
- **功能描述**：向家庭食谱库添加新菜式
- **输入**：
  - 菜式名称（必填）
  - 菜式分类（可选）
  - 食材列表（必填，至少1项）：
    - 食材ID（必填，从系统基础食材库选择）
    - 食材名称（自动回显，允许展示别名）
    - 数量
    - 单位（g、kg、个、勺等），默认带出基础食材推荐单位
    - 备注（可选，用于补充处理方式或口味信息）
  - 烹饪步骤（必填）：
    - 步骤序号
    - 步骤内容
    - 步骤图片（可选）
- **输出**：菜式ID、菜式信息
- **业务规则**：
  - 免费版：最多30个菜式
  - 付费版：最多60个菜式
  - 菜式名称不能重复（同一家庭内）
  - 至少需要1个食材和1个烹饪步骤
  - 食材必须引用基础食材库，若库中没有目标食材，需要运营/管理员提前入库
  - 同一道菜中不可重复添加同一基础食材+单位的组合，避免购物清单出现重复统计

#### 2.2.2 语音输入菜式
- **功能描述**：通过语音输入菜式信息，系统自动整理
- **输入**：语音文件（mp3、wav等格式）
- **输出**：整理后的菜式信息
- **业务规则**：
  - 仅付费用户可用
  - 每天限制10次
  - AI自动去除语气词
  - AI修正逻辑不通的地方
  - 生成规范的菜式格式

#### 2.2.3 编辑/删除菜式
- **功能描述**：修改或删除已有菜式
- **业务规则**：
  - 只有创建者或家庭管理员可以编辑/删除
  - 删除菜式时，如果该菜式在菜单中使用，需要提示用户

#### 2.2.4 菜式分类
- **功能描述**：对菜式进行分类管理
- **分类类型**：
  - 按食材：肉类、蔬菜、海鲜、汤类等
  - 按口味：清淡、重口味、甜、辣等
  - 按难度：简单、中等、复杂
  - 自定义分类

#### 2.2.5 基础食材库
- **功能描述**：维护一份平台级的基础食材库，提供统一的食材ID、分类、默认单位和存放时长，供菜式与购物清单引用
- **功能点**：
  - 搜索、筛选并查看所有食材的基本信息（名称、分类、建议单位、存放天数、备注）
  - 新增/编辑/禁用食材，支持补充别名或英文/拼音以方便检索
  - 批量导入常规食材，便于上线前一次性初始化
  - 仅管理员或具备权限的运营角色可以维护
- **业务规则**：
  - 每个食材名称唯一，禁用的食材不会出现在菜式录入的候选列表
  - 菜式引用基础食材后，只存储用量信息，购物清单将基于基础食材ID完成聚合

#### 2.2.6 食材选择体验
- **功能描述**：面向普通用户（录入菜式、购物清单时），提供精准的食材搜索与分类浏览能力，帮助用户快速找到正确的基础食材ID
- **功能点**：
  - **模糊搜索**：根据用户输入的关键字实时返回最多10条匹配结果（按名称、别名、拼音匹配），返回内容包含食材ID、名称、分类、默认单位、存放天数
  - **分类筛选**：按食材分类分页查询（默认20条/页），支持分类下的关键字过滤，方便用户在某一类食材里浏览并选择
  - 搜索接口主要用于输入框下拉建议；分类接口主要用于“按分类选择”或“查看更多”场景
- **业务规则**：
  - 仅返回 `is_active = true` 的食材
  - 搜索接口限流（如每秒不超过5次/IP）避免频繁请求
  - 返回结果中需包含 `ingredient_id`，以便前端直接提交

### 2.3 菜单规划模块

#### 2.3.1 创建菜单
- **功能描述**：为某一天某一餐创建菜单
- **输入**：
  - 日期（必填）
  - 餐次（早餐/午餐/晚餐，必填）
  - 菜式列表（从家庭食谱中选择，至少1个）
- **输出**：菜单ID、菜单信息
- **业务规则**：
  - 同一日期同一餐次只能有一个菜单
  - 可以覆盖已有菜单
  - 菜单可以包含多个菜式

#### 2.3.2 查看菜单
- **功能描述**：查看每日或每周菜单
- **视图类型**：
  - 日视图：显示某一天的三餐菜单
  - 周视图：显示一周的菜单
  - 月视图：显示一个月的菜单（可选）
- **显示内容**：
  - 日期、餐次
  - 菜式列表
  - 菜式图片
  - 预计烹饪时间

#### 2.3.3 编辑菜单
- **功能描述**：修改已有菜单
- **操作**：
  - 添加菜式
  - 删除菜式
  - 修改日期或餐次

#### 2.3.4 AI生成菜单（付费）
- **功能描述**：AI根据用户身体状况自动生成菜单
- **输入**：
  - 日期范围（开始日期、结束日期）
  - 用户列表（可选，默认所有家庭成员）
- **输出**：生成的菜单列表、推荐理由
- **业务规则**：
  - 仅付费用户可用
  - 每周限制5次
  - 基于用户身体状况分析
  - 结合家庭食谱库
  - 考虑营养搭配

#### 2.3.5 AI分析菜单（付费）
- **功能描述**：AI分析菜单的合理性
- **输入**：菜单ID列表
- **输出**：
  - 营养分析
  - 是否适合身体状况
  - 优化建议
- **业务规则**：
  - 仅付费用户可用
  - 每周限制5次
  - 分析内容包括：
    - 营养均衡性
    - 热量分析
    - 食材搭配合理性
    - 是否适合当前身体状况

### 2.4 购物清单模块

#### 2.4.1 生成购物清单
- **功能描述**：根据菜单自动生成购物清单
- **输入**：
  - 日期范围（开始日期、结束日期）
  - 菜单列表（可选，默认选择日期范围内的所有菜单）
- **输出**：购物清单
- **业务规则**：
  - 基于菜式食材表中的 `ingredient_id` 自动合并相同食材，解决命名差异导致的重复
  - 计算总数量
  - 按食材分类展示（默认使用基础食材的分类，可根据清单需要重新分组）
  - 显示基础食材配置的建议存放时间

#### 2.4.2 购物清单内容
- **清单项包含**：
  - 食材名称（来自基础食材库）
  - 食材ID（便于与菜式和后续采购数据关联）
  - 总数量
  - 单位
  - 分类（蔬菜、肉类、调料等）
  - 存放时间（天数，默认读取基础食材配置）
  - 购买状态（待购买/已购买）

#### 2.4.3 编辑购物清单
- **功能描述**：手动编辑购物清单
- **操作**：
  - 添加食材（依然从基础食材库选择，保持聚合规则一致）
  - 删除食材
  - 修改数量
  - 标记已购买

#### 2.4.4 购物清单分享
- **功能描述**：将购物清单分享给家庭成员
- **分享方式**：
  - 小程序内分享
  - 生成图片分享
  - 导出为文本

### 2.5 身体状况管理模块（付费）

#### 2.5.1 录入身体状况
- **功能描述**：用户录入自己的身体状况信息
- **输入内容**：
  - 疾病信息：选择或输入疾病名称（如：高血压、糖尿病等）
  - 工作状态：选择忙碌程度（很忙、一般、不忙）
  - 压力水平：选择压力大小（高、中、低）
  - 身体感觉：文字描述（如：最近有点累，睡眠不好）
- **输出**：身体状况记录ID

#### 2.5.2 AI分析身体状况
- **功能描述**：AI分析用户身体状况并给出建议
- **输入**：身体状况记录ID
- **输出**：
  - 身体状况分析
  - 健康建议
  - 饮食建议
- **业务规则**：
  - 仅付费用户可用
  - 每天每人限制2次
  - 分析基于录入的信息
  - 结合医学知识库

#### 2.5.3 身体状况历史
- **功能描述**：查看历史身体状况记录
- **显示内容**：
  - 记录时间
  - 录入信息
  - AI分析结果
  - 趋势分析（可选）

### 2.6 烹饪步骤优化模块（付费）

#### 2.6.1 AI优化烹饪步骤
- **功能描述**：AI整合多道菜的烹饪步骤，提高效率
- **输入**：
  - 菜式ID列表
  - 餐次类型
- **输出**：
  - 优化后的烹饪步骤
  - 时间规划
  - 效率提升说明
- **业务规则**：
  - 仅付费用户可用
  - 分析多道菜的烹饪步骤
  - 优化烹饪顺序
  - 整合可以同时进行的步骤
  - 提供时间规划建议

#### 2.6.2 优化结果展示
- **展示内容**：
  - 优化前步骤
  - 优化后步骤
  - 节省时间
  - 效率提升百分比

## 3. 非功能需求

### 3.1 性能需求
- 接口响应时间：< 500ms（95%请求）
- AI服务响应时间：< 5s
- 支持并发用户数：1000+
- 数据库查询优化：关键查询 < 100ms

### 3.2 安全需求
- 用户密码加密存储（bcrypt）
- 敏感数据传输加密（HTTPS）
- JWT Token认证
- API接口限流
- 防止SQL注入、XSS攻击

### 3.3 可用性需求
- 系统可用性：99.5%
- 数据备份：每天全量备份
- 故障恢复时间：< 1小时

### 3.4 兼容性需求
- 小程序：支持微信小程序
- 浏览器：Chrome、Safari、微信内置浏览器
- 移动端：iOS 12+、Android 8+

### 3.5 用户体验需求
- 界面简洁易用
- 操作流程顺畅
- 错误提示明确
- 加载状态提示

## 4. 业务规则总结

### 4.1 用户规则
- 一个用户只能属于一个家庭
- 用户可以创建家庭或加入家庭
- 家庭管理员可以管理家庭成员

### 4.2 食谱规则
- 免费版：最多30个菜式
- 付费版：最多60个菜式
- 菜式名称在同一家庭内不能重复

### 4.3 AI功能规则
- 语音输入整理：每天10次
- 身体状况分析：每天每人2次
- 菜单生成：每周5次
- 菜单分析：每周5次
- 烹饪步骤优化：无限制（付费用户）

### 4.4 菜单规则
- 同一日期同一餐次只能有一个菜单
- 菜单可以包含多个菜式
- 菜单可以手动创建或AI生成

### 4.5 购物清单规则
- 根据菜单自动生成
- 自动合并相同食材
- 支持手动编辑

## 5. 数据需求

### 5.1 数据存储
- 用户数据：个人信息、家庭成员关系
- 食谱数据：菜式、食材、烹饪步骤
- 菜单数据：每日菜单、每周菜单
- 购物清单数据：清单项、购买状态
- 身体状况数据：记录、分析结果
- 会员数据：订阅信息、使用记录

### 5.2 数据统计
- 用户数量、家庭数量
- 菜式数量、菜单数量
- AI功能使用情况
- 会员订阅情况

## 6. 扩展需求（未来版本）

### 6.1 社区功能
- 菜谱分享
- 用户互动
- 菜谱评价

### 6.2 营养分析
- 详细营养成分计算
- 热量分析
- 营养建议

### 6.3 智能推荐
- 基于历史数据的个性化推荐
- 季节性推荐
- 节日推荐

### 6.4 多端支持
- Web端
- iOS App
- Android App
