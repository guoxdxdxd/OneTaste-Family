# API 接口文档

## 基础信息

### 基础URL
```
开发环境：http://localhost:8080/api/v1
生产环境：https://api.onetastefamily.com/api/v1
```

### 认证方式
使用JWT Token认证，在请求头中携带：
```
Authorization: Bearer {token}
```

### 响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 错误码说明
- 200: 成功
- 400: 请求参数错误
- 401: 未授权
- 403: 无权限
- 404: 资源不存在
- 500: 服务器错误

---

## 用户认证

### 用户注册
```
POST /auth/register
```

**请求参数：**
```json
{
  "phone": "13800138000",
  "password": "password123",
  "verify_code": "123456",
  "nickname": "张三"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "user_id": 1,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 用户登录
```
POST /auth/login
```

**请求参数：**
```json
{
  "phone": "13800138000",
  "password": "password123"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user_id": 1,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200
  }
}
```

### 获取用户信息
```
GET /user/info
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "phone": "13800138000",
    "nickname": "张三",
    "avatar": "https://...",
    "membership": {
      "type": "free",
      "expires_at": null
    }
  }
}
```

---

## 家庭管理

### 创建家庭
```
POST /family/create
```

**请求参数：**
```json
{
  "name": "张家的厨房",
  "description": "温馨的家庭"
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "family_id": 1,
    "name": "张家的厨房",
    "member_count": 1
  }
}
```

### 获取家庭信息
```
GET /family/info
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "family_id": 1,
    "name": "张家的厨房",
    "member_count": 3,
    "dish_count": 15,
    "max_dishes": 30
  }
}
```

### 邀请家庭成员
```
POST /family/member/invite
```

**请求参数：**
```json
{
  "phone": "13900139000",
  "role": "member"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "邀请已发送"
}
```

### 获取家庭成员列表
```
GET /family/members
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "members": [
      {
        "user_id": 1,
        "nickname": "张三",
        "role": "owner",
        "joined_at": "2024-01-01T00:00:00Z"
      }
    ]
  }
}
```

---

## 食谱管理

### 创建菜式
```
POST /dishes
```

**请求参数：**
```json
{
  "name": "红烧肉",
  "category": "肉类",
  "ingredients": [
    {
      "name": "五花肉",
      "amount": 500,
      "unit": "g"
    },
    {
      "name": "生抽",
      "amount": 2,
      "unit": "勺"
    }
  ],
  "steps": [
    {
      "order": 1,
      "content": "将五花肉切块"
    },
    {
      "order": 2,
      "content": "热锅下油，炒糖色"
    }
  ]
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "dish_id": 1,
    "name": "红烧肉"
  }
}
```

### 获取菜式列表
```
GET /dishes?page=1&page_size=20&category=肉类
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "dishes": [
      {
        "dish_id": 1,
        "name": "红烧肉",
        "category": "肉类",
        "created_at": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 15,
    "page": 1,
    "page_size": 20
  }
}
```

### 获取菜式详情
```
GET /dishes/{id}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "dish_id": 1,
    "name": "红烧肉",
    "category": "肉类",
    "ingredients": [...],
    "steps": [...],
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

### 更新菜式
```
PUT /dishes/{id}
```

### 删除菜式
```
DELETE /dishes/{id}
```

### 语音输入菜式（付费）
```
POST /dishes/voice-input
```

**请求参数：**
```json
{
  "audio_url": "https://...",
  "audio_format": "mp3"
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "dish": {
      "name": "红烧肉",
      "ingredients": [...],
      "steps": [...]
    },
    "remaining_count": 9
  }
}
```

---

## 菜单管理

### 创建菜单
```
POST /menus
```

**请求参数：**
```json
{
  "date": "2024-01-15",
  "meal_type": "dinner",
  "dish_ids": [1, 2, 3]
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "menu_id": 1,
    "date": "2024-01-15",
    "meal_type": "dinner",
    "dishes": [...]
  }
}
```

### 获取每日菜单
```
GET /menus/daily?date=2024-01-15
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "date": "2024-01-15",
    "menus": [
      {
        "meal_type": "breakfast",
        "dishes": [...]
      },
      {
        "meal_type": "lunch",
        "dishes": [...]
      },
      {
        "meal_type": "dinner",
        "dishes": [...]
      }
    ]
  }
}
```

### 获取每周菜单
```
GET /menus/weekly?start_date=2024-01-15
```

### AI生成菜单（付费）
```
POST /menus/ai-generate
```

**请求参数：**
```json
{
  "start_date": "2024-01-15",
  "days": 7,
  "user_ids": [1, 2]
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "menus": [...],
    "reason": "根据您的身体状况，推荐...",
    "remaining_count": 4
  }
}
```

### AI分析菜单（付费）
```
POST /menus/ai-analyze
```

**请求参数：**
```json
{
  "menu_ids": [1, 2, 3, 4, 5]
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "analysis": "您的菜单营养搭配合理...",
    "suggestions": ["建议增加蔬菜...", "减少油腻食物..."],
    "remaining_count": 4
  }
}
```

---

## 购物清单

### 生成购物清单
```
POST /shopping-lists/generate
```

**请求参数：**
```json
{
  "start_date": "2024-01-15",
  "end_date": "2024-01-21",
  "menu_ids": [1, 2, 3]
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "list_id": 1,
    "items": [
      {
        "ingredient_name": "五花肉",
        "total_amount": 1500,
        "unit": "g",
        "category": "肉类",
        "storage_days": 3
      }
    ],
    "total_items": 20
  }
}
```

### 获取购物清单
```
GET /shopping-lists/{id}
```

### 更新购物清单
```
PUT /shopping-lists/{id}
```

### 切换购物项状态
```
POST /shopping-lists/{id}/items/{itemId}/toggle
```

---

## 身体状况（付费）

### 录入身体状况
```
POST /health/record
```

**请求参数：**
```json
{
  "diseases": ["高血压"],
  "work_status": "很忙",
  "stress_level": "高",
  "body_feelings": "最近有点累，睡眠不好"
}
```

### AI分析身体状况
```
POST /health/analyze
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "analysis": "根据您的身体状况，建议...",
    "recommendations": ["多休息", "清淡饮食"],
    "remaining_count": 1
  }
}
```

### 获取身体状况记录
```
GET /health/records?page=1&page_size=20
```

---

## 烹饪步骤优化（付费）

### AI优化烹饪步骤
```
POST /cooking/optimize
```

**请求参数：**
```json
{
  "dish_ids": [1, 2, 3],
  "meal_type": "dinner"
}
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "optimized_steps": [
      {
        "order": 1,
        "content": "同时准备：切五花肉、洗青菜、准备调料",
        "time": "10分钟"
      },
      {
        "order": 2,
        "content": "先做红烧肉（需要炖煮30分钟）",
        "time": "30分钟"
      }
    ],
    "total_time": "45分钟",
    "efficiency": "比单独做节省15分钟"
  }
}
```

---

## 支付相关

### 订阅会员
```
POST /payment/subscribe
```

**请求参数：**
```json
{
  "plan": "monthly",
  "payment_method": "wechat"
}
```

### 获取会员信息
```
GET /payment/membership
```

**响应：**
```json
{
  "code": 200,
  "data": {
    "type": "premium",
    "expires_at": "2024-02-15T00:00:00Z",
    "features": {
      "max_dishes": 60,
      "ai_voice_input": {
        "daily_limit": 10,
        "remaining": 8
      },
      "ai_health_analyze": {
        "daily_limit": 2,
        "remaining": 1
      },
      "ai_menu_generate": {
        "weekly_limit": 5,
        "remaining": 3
      },
      "ai_menu_analyze": {
        "weekly_limit": 5,
        "remaining": 4
      }
    }
  }
}
```

---

## 错误处理

### 错误响应格式
```json
{
  "code": 400,
  "message": "请求参数错误",
  "errors": [
    {
      "field": "phone",
      "message": "手机号格式不正确"
    }
  ]
}
```

### 常见错误码
- 1001: 手机号已注册
- 1002: 验证码错误
- 1003: 密码错误
- 2001: 家庭不存在
- 2002: 无权限操作
- 3001: 菜式数量已达上限
- 4001: AI调用次数已用完
- 5001: 支付失败

